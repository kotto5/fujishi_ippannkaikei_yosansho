# 次のAgentへの引き継ぎ指示

## タスク概要
富士市の一般会計予算書をデータ化するプロジェクトです。
背景として、富士市の一般会計予算書はPDFで配布されており、データ分析がしづらい状態になっています。そのため、まずはデータを分析可能な形に変換することを目的としています。

## 具体的なステップ：
1. PDFからのデータをJSONに変換します。
このやり方は任せますが、OCRテキストからJSONを推測して埋めていくことはできると思います。
整合性のチェックで、BUDGET.PDFを画像ファイルとして分析して最終的に確認していくのは必要だと思います。やり方については、実行していく中でこのドキュメントを整備して、より良くしていきましょう。

2. json_to_csv.pyを使用して、JSONのデータをCSVに置換します。
3. 開発者がCSVのデータをスプレッドシートにインポートすることで、分析を可能にします。

## ファイル構成

./ (root)
README.md: このファイル. タスク実行者が読むべきドキュメント
json_to_csv.py: PDFのデータをJSON化したものを、CSVにコンバートするプログラム
sample_歳入.json: 歳入の 特に 市税(款)のJSONのサンプル

./n年度予算/
- Budget.pdf：予算の元データ
- bugget.pdf_ocr: macOSのOCRを利用して、PDFを文字起こししたもの
- Budget.json：予算をJSON化したもの
- Budget.csv：json_to_csv.py でJSONをCSV化したもの

## 注意点
1. bugget.pdf データは 70MB 前後です。トークン制限に引っかかる可能性があるので、作業を開始する前にサイズを確認して、必要であれば分割しましょう
分割する方法
- ユーザーにPDFファイルの分割を依頼
- タスク実行者が分割する

2. 同様に、ocr も大きいです. 一度 ocr/ に それぞれ分割していくのが良いかもしれません

3. CSVのデータを編集してはなりません。あくまで編集するのはJSONデータであり、CSVの生成はPythonのプログラムを通して行います. 必要であれば、csv は .gitignore に入れることを考えています

4. pdf データにある、数値データのうち 計算式が入るものに関しては、テキストとして扱いましょう。
ex: 測定見込額 408,000×98.9％ というデータに対しては
"測定見込額": "408000*98.9%"
のようにしましょう
a. 演算子をプログラミングの一般的なものに
b. カンマ (,) は削除する
c. 単位 (%) は 半角の % を利用する

5. 節 と 説明の最初の行でデータが重複している場合は、説明の行を削除しましょう. つまり、必ずしも データ全てが1対1入力されるわけではないが、データの構造化によって情報量を失わず、より扱いやすいデータ構造にする

6. 金額が (千円) などと示されているところは、入力する数値を1000倍する必要がある

ex:
元データ
"""
15,717,0001 現年課税分 現年課税分 15,717,000
均等割 403,000
調定見込額 408,000×98.9％
所得割 15,314,000
調定見込額 （15,490,000-5,000）×98.9％
"""

期待するjson
```json
{
  "現年課税分": {
    "金額": 15717000000,
    "説明": {
      "均等制": {
        "金額": 403000000,
        "測定見込額": "408000*98.9%"
      },
      "所得割": {
        "金額": 15314000000,
        "測定見込額": "(15490000-5000)*98.9%"
      }
    }
  }
}
```

## 確認点
claude code の 1セッションのトークン制限のサイズは?

## ファイルの場所
- JSON: `/home/claude/json/歳出_*.json` （14ファイル、要置換）
- CSV: `/home/claude/csv/歳出_*.csv` （14ファイル、JSON再生成後に再変換）
- JSON→CSV変換: `/home/claude/json_to_csv.py`
- 完成済み歳入例: `/home/claude/json/歳入_市税.json`

## CSV出力フォーマット
```
款,項,目,節,説明,R6,R7
議会費,,,,,481596,499446
,議会費,,,,481596,499446
,,議会費,,,481596,499446
,,,報酬,,,205923
,,,,議長等議員報酬,,205923
```
- UTF-8（BOMなし）、LF改行
- 金額は千円単位、カンマ区切りなし

## データソース
富士市のサイト: https://www.city.fuji.shizuoka.jp/documents/7863/hngtkl000000jj0q_1.pdf
（600ページ超の完全版予算書。歳出事項別明細書は中盤〜後半に収録）

**重要**: スキャンPDFではなく、テキスト埋め込みPDFを使うこと。上記URLの原本はテキスト型。

## 作業手順
1. PDFから歳出事項別明細書のテキストを抽出
2. 各款ごとにJSONファイルを作成（上記フォーマット準拠）
3. ./json_to_csv.py でCSV一括再生成
4. 合計値の検証

## 注意点
- 前回PDF全体を一度にfetchした際、トークン上限で歳出部分が欠落した
- 款ごとまたは数款ずつ処理すること
- 歳出の節は歳入と異なり、1報酬 2給料 3職員手当等 ... のような番号付き科目体系
- 説明欄には事業名と金額の内訳が記載される
